<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Install PL/Rust on Debian/Ubuntu - PL/Rust Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="plrust.html">What is PL/Rust?</a></li><li class="chapter-item expanded affix "><li class="part-title">Installation</li><li class="chapter-item expanded "><a href="install-prerequisites.html"><strong aria-hidden="true">1.</strong> Install Prerequisites</a></li><li class="chapter-item expanded "><a href="install-plrust.html"><strong aria-hidden="true">2.</strong> Install PL/Rust</a></li><li class="chapter-item expanded "><a href="update-plrust.html"><strong aria-hidden="true">3.</strong> Update PL/Rust</a></li><li class="chapter-item expanded "><a href="install-plrust-on-debian-ubuntu.html" class="active"><strong aria-hidden="true">4.</strong> Install PL/Rust on Debian/Ubuntu</a></li><li class="chapter-item expanded "><a href="try-plrust-with-docker.html"><strong aria-hidden="true">5.</strong> Try PL/Rust with Docker</a></li><li class="chapter-item expanded affix "><li class="part-title">PL/Rust Usage</li><li class="chapter-item expanded "><a href="use-plrust.html"><strong aria-hidden="true">6.</strong> PL/Rust Functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="functions/anatomy.html"><strong aria-hidden="true">6.1.</strong> Function Anatomy</a></li><li class="chapter-item expanded "><a href="functions/arguments.html"><strong aria-hidden="true">6.2.</strong> Arguments</a></li><li class="chapter-item expanded "><a href="functions/return-type.html"><strong aria-hidden="true">6.3.</strong> Return Type</a></li><li class="chapter-item expanded "><a href="functions/set-returning-functions.html"><strong aria-hidden="true">6.4.</strong> Set Returning Functions</a></li></ol></li><li class="chapter-item expanded "><a href="data-types.html"><strong aria-hidden="true">7.</strong> Data types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="data-types/no-unsigned-types.html"><strong aria-hidden="true">7.1.</strong> No Unsigned Types</a></li><li class="chapter-item expanded "><a href="data-types/arrays.html"><strong aria-hidden="true">7.2.</strong> Arrays</a></li><li class="chapter-item expanded "><a href="data-types/udts.html"><strong aria-hidden="true">7.3.</strong> User Defined Types</a></li></ol></li><li class="chapter-item expanded "><a href="built-in-functions.html"><strong aria-hidden="true">8.</strong> Built-in functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="logging.html"><strong aria-hidden="true">8.1.</strong> Logging to PostgreSQL from PL/Rust</a></li><li class="chapter-item expanded "><a href="triggers.html"><strong aria-hidden="true">8.2.</strong> Triggers</a></li><li class="chapter-item expanded "><a href="spi.html"><strong aria-hidden="true">8.3.</strong> SPI</a></li><li class="chapter-item expanded "><a href="dynamic-function-calling.html"><strong aria-hidden="true">8.4.</strong> Dynamic Function Calling</a></li></ol></li><li class="chapter-item expanded "><a href="trusted-untrusted.html"><strong aria-hidden="true">9.</strong> Trusted and Untrusted PL/Rust</a></li><li class="chapter-item expanded "><a href="config-pg.html"><strong aria-hidden="true">10.</strong> PostgreSQL configuration</a></li><li class="chapter-item expanded affix "><li class="part-title">PL/Rust Under the Hood</li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">11.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="designing-for-trust.html"><strong aria-hidden="true">12.</strong> Designing for Trust</a></li><li class="chapter-item expanded "><a href="dependencies.html"><strong aria-hidden="true">13.</strong> External Dependencies</a></li><li class="chapter-item expanded "><a href="config-lints.html"><strong aria-hidden="true">14.</strong> Lints</a></li><li class="chapter-item expanded "><a href="config-env-var.html"><strong aria-hidden="true">15.</strong> Environment variables</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PL/Rust Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="install-plrust-on-debianubuntu"><a class="header" href="#install-plrust-on-debianubuntu">Install PL/Rust on Debian/Ubuntu</a></h1>
<p>Debian packages for PL/Rust are available for download on the Github Releases page here: <a href="https://github.com/tcdi/plrust/releases">https://github.com/tcdi/plrust/releases</a></p>
<h2 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h2>
<p>The provided Debian packages for PL/Rust make certain assumptions about the environment in which they are installed. Notably, they require PostgreSQL either has been installed or will be installed with the official <a href="https://www.postgresql.org/download/linux/debian/">Postgres Debian packages</a>. Because of this, the PL/Rust Debian packages assume:</p>
<ul>
<li>The user which runs Postgres is <code>postgres</code></li>
<li>The home directory for the <code>postgres</code> user is located at <code>/var/lib/postgresql</code></li>
<li>The <code>postgres</code> user has the ability to create and manage databases and extensions</li>
<li>The <code>postgres</code> user has the ability to install Rust and all of the required dependencies</li>
</ul>
<h2 id="filename-convention"><a class="header" href="#filename-convention">Filename convention</a></h2>
<p>The PL/Rust artifacts that are uploaded to Github releases follow this pattern:</p>
<pre><code>plrust-trusted-&lt;PLRUSTVER&gt;_&lt;RUSTTOOLCHAINVER&gt;-debian-pg&lt;PGMAJORVER&gt;-&lt;DPKGARCH&gt;.deb
</code></pre>
<p>Where:</p>
<ul>
<li>PLRUSTVER is the PL/Rust release version</li>
<li>RUSTTOOLCHAINVER is the version of Rust+toolchains in which the Debian package was built</li>
<li>PGMAJORVER is the major version of PostgreSQL the package targets, such as 13, 14 or 15</li>
<li>DPKGARCH is the CPU architecture name according to <code>dpkg</code>, such as <code>arm64</code> or <code>amd64</code></li>
</ul>
<p>Example:</p>
<pre><code>plrust-trusted-1.2.3_1.72.0-debian-pg15-amd64.deb
</code></pre>
<h2 id="preparing-the-environment"><a class="header" href="#preparing-the-environment">Preparing the environment</a></h2>
<p>Certain applications, libraries and dependencies must be set up before PL/Rust can be installed from a Debian package.</p>
<p>Note that the following instructions assume <code>sudo</code> capabilities.</p>
<h3 id="system-and-development-requirements"><a class="header" href="#system-and-development-requirements">System and development requirements</a></h3>
<p>Because PL/Rust is a compiled language, certain libraries and development tools will be required to be installed:</p>
<pre><code>sudo apt-get update &amp;&amp; \
sudo apt-get install -y --no-install-recommends \
    build-essential \
    ca-certificates \
    clang \
    clang-11 \
    gcc \
    git \
    gnupg \
    libssl-dev \
    llvm-11 \
    lsb-release \
    make \
    pkg-config \
    wget
</code></pre>
<h3 id="installing-postgres"><a class="header" href="#installing-postgres">Installing Postgres</a></h3>
<p>If Postgres has already been installed with the official <a href="https://www.postgresql.org/download/linux/debian/">Postgres Debian packages</a>, then skip this section and proceed to <a href="#installing-rust-and-components">Installing Rust and components</a></p>
<ol>
<li>Set up the official PostgreSQL APT repository:
<pre><code>echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" | \
  sudo tee -a /etc/apt/sources.list.d/pgdg.list &gt; /dev/null
</code></pre>
<pre><code>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | \
  gpg --dearmor | sudo tee -a /etc/apt/trusted.gpg.d/apt.postgresql.org.gpg &gt;/dev/null
</code></pre>
</li>
<li>Update APT and install PostgreSQL. Replace <code>XX</code> with the PostgreSQL major version to be installed (e.g. 13, 14, 15):
<pre><code>sudo apt-get update -y -qq --fix-missing &amp;&amp; \
sudo apt-get install -y --no-install-recommends \
    postgresql-XX \
    postgresql-server-dev-XX
</code></pre>
</li>
</ol>
<h3 id="installing-rust-and-components"><a class="header" href="#installing-rust-and-components">Installing Rust and components</a></h3>
<p>A key component of making PL/Rust work is the Rust compiler and components. However, Rust and its tooling must be installed as the <code>postgres</code> user. If the package-required version of Rust and toolchains are already installed and defaulted for the <code>postgres</code> user, then skip this section and proceed to <a href="#installing-plrust">Installing PL/Rust</a>.</p>
<p>Instructions that follow assume the latest version of PL/Rust, which requires <code>1.72.0</code> of Rust and toolchain set. If the desired PL/Rust Debian package requires a different version of the toolchain set (as indicated by the <a href="#filename-convention">filename</a>), then substitute that version in the following instructions.</p>
<ol>
<li>Switch to the <code>postgres</code> user:
<pre><code>sudo su -l - postgres
</code></pre>
</li>
<li>If Rust has never been installed as the <code>postgres</code> user, then run the following:
<pre><code>wget -qO- https://sh.rustup.rs | \
  sh -s -- \
  -y \
  --profile minimal \
  --default-toolchain=1.72.0

source "$HOME/.cargo/env"
</code></pre>
</li>
<li>If Rust has previously been installed as the <code>postgres</code> user, then ensure that the <code>1.72.0</code> toolchain is installed and set to default:
<pre><code>rustup toolchain install 1.72.0
rustup default 1.72.0
</code></pre>
</li>
<li>Ensure that the <code>rustc-dev</code> component has been installed:
<pre><code>rustup component add rustc-dev
</code></pre>
</li>
<li>Drop back to your normal user:
<pre><code>exit
</code></pre>
</li>
</ol>
<p>Future versions of PL/Rust may require a different version of the Rust toolchain to be installed and set to default. In such an event, step 3 and onward must be repeated with the new required version of the specific toolchain. The filename of the PL/Rust Debian package contains the version of the Rust toolchain it was built with -- see <a href="#filename-convention">Filename convention</a> for more details.</p>
<h3 id="installing-plrust"><a class="header" href="#installing-plrust">Installing PL/Rust</a></h3>
<p>With the prerequisites installed and set up, it is time to install the PL/Rust Debian package.</p>
<ol>
<li>Head to <a href="https://github.com/tcdi/plrust/releases">the PL/Rust releases page</a> and download the appropriate version onto the target system. When choosing a destination in which to place the dowloaded Debian package, pick a directory that is readable and writable by the <code>_apt</code> user, such <code>/tmp</code>. Otherwise, the installation might produce an error.</li>
<li>Install the package:
<pre><code>sudo apt install /tmp/plrust-trusted-X.X.X_1.72.0-debian-pgXX-yourarch.deb
</code></pre>
</li>
</ol>
<p>The package installation will fail if at least one of the above Rust dependencies are not met.</p>
<h4 id="service-restart-notice"><a class="header" href="#service-restart-notice">Service Restart Notice</a></h4>
<p>Newer versions of Debian/Ubuntu may prompt for a restart of certain services during the Debian package installation process, notably the PostgreSQL server service. Take caution in determining the appropriate time for the PostgreSQL service to be restarted. For example, if the GUC settings have not been set up before as outlined in the following <a href="#configuring-postgresql">Configuring PostgreSQL</a> section, then it may be advisable to delay the restart until after those are set up. It may also be advisable to delay a restart for a system that is already in production.</p>
<p>Regardless of timing, PostgreSQL will need to be restarted in any of the following conditions:</p>
<ol>
<li>PL/Rust is installed for the first time and GUC additions have been added</li>
<li>PL/Rust is updated on an existing system at some point in the future, with or without GUC changes</li>
<li>Any GUC change is required for an existing PL/Rust setup</li>
</ol>
<h3 id="configuring-postgresql"><a class="header" href="#configuring-postgresql">Configuring PostgreSQL</a></h3>
<p>In order for PL/Rust to be available to the PostgreSQL server, some new <a href="https://www.postgresql.org/docs/current/config-setting.html">GUC</a> settings must configured. See the <a href="config-pg.html">PostgreSQL Configuration for PL/Rust</a> for more details on the required setup and other options that may be necessary.</p>
<p>Any configuration changes will require a restart of the PostgreSQL service on the system.</p>
<h3 id="finishing-up"><a class="header" href="#finishing-up">Finishing up</a></h3>
<p>To test if PL/Rust is set up correctly, load up <code>psql</code> as the <code>postgres</code> user</p>
<pre><code>sudo su -l - postgres
psql
</code></pre>
<p>and run the following:</p>
<pre><code class="language-SQL">CREATE EXTENSION plrust;
</code></pre>
<p>Then, create a simple function and try it out:</p>
<pre><code class="language-SQL">CREATE OR REPLACE FUNCTION plrust.one()
    RETURNS INT LANGUAGE plrust
AS
$$
    Ok(Some(1))
$$;
</code></pre>
<pre><code class="language-SQL">SELECT plrust.one();
</code></pre>
<pre><code>┌─────┐
│ one │
╞═════╡
│   1 │
└─────┘
</code></pre>
<h2 id="updating"><a class="header" href="#updating">Updating</a></h2>
<p>Future versions of PL/Rust can be installed using the same methods described in <a href="#installing-plrust">Installing PL/Rust</a>. One consideration when upgrading is that new versions of PL/Rust may require a different version of the Rust toolchain. See <a href="#installing-rust-and-components">Installing Rust and components</a> for details.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="update-plrust.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="try-plrust-with-docker.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="update-plrust.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="try-plrust-with-docker.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
